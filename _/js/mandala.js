// Generated by CoffeeScript 1.3.3
(function() {
  var Circles, Mandala, MandalaAttrs;

  MandalaAttrs = Backbone.Model.extend({
    defaults: {
      id: 'canvas',
      width: 400,
      height: 400,
      num_circles: 8,
      step: 0.005,
      offset: 0.0,
      go: false
    },
    initialize: function() {
      return this.set({
        mid: {
          x: this.get('width') / 2,
          y: this.get('height') / 2
        },
        avg: (this.get('height') + this.get('width')) / 2
      });
    },
    inc: function() {
      return this.set({
        offset: this.get('offset') + this.get('step')
      });
    },
    toggle: function() {
      this.set({
        go: !(this.get('go'))
      });
      return this.get('go');
    }
  });

  Circles = (function() {

    function Circles() {}

    Circles.prototype.initialize = function(mandala) {
      this.mandala = mandala;
      this.num_circles = 6;
      return this.draw();
    };

    Circles.prototype.draw = function() {
      var angle, i, x, y, _i, _ref, _results;
      _results = [];
      for (i = _i = 1, _ref = this.num_circles; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
        angle = ((2.0 * Math.PI / this.num_circles) * i) + this.mandala.offset;
        x = this.mandala.avg / 3 * Math.sin(angle);
        y = this.mandala.avg / 3 * Math.cos(angle);
        this.mandala.canvas.beginPath();
        this.mandala.canvas.arc(this.mandala.mid.x + x, this.mandala.mid.y + y, this.mandala.avg / 15, 0, 2.0 * Math.PI);
        _results.push(this.mandala.canvas.stroke());
      }
      return _results;
    };

    return Circles;

  })();

  Mandala = (function() {

    function Mandala(id) {
      var _this = this;
      this.attrs = new MandalaAttrs({
        id: id
      });
      this.canvas_el = $("#" + this.attrs.id).get(0);
      this.canvas = this.canvas_el.getContext('2d');
      this.circle_jerker = $('#num_circles');
      this.circle_jerker.change(function(event) {
        _this.attrs.set({
          num_circles: _this.circle_jerker.attr('value')
        });
        _this.draw();
        return null;
      });
      this.speed = $('#speed');
      this.speed.change(function(event) {
        _this.attrs.set({
          step: _this.speed.attr('value') / 1000
        });
        return null;
      });
      this.toggler = $('#go');
      this.toggler.click(function(event) {
        if (_this.attrs.toggle()) {
          return _this.go();
        } else {
          return _this.stop();
        }
      });
      this.animate_interval = null;
      if (this.attrs.get('go')) {
        this.go();
      } else {
        this.draw();
        this.stop();
      }
    }

    Mandala.prototype.go = function() {
      var _this = this;
      if (!this.animate_interval) {
        this.animate_interval = setInterval((function() {
          _this.draw();
          return _this.attrs.inc();
        }), 1000.0 / 30.0);
      }
      return this.toggler.attr('value', 'Stop');
    };

    Mandala.prototype.stop = function() {
      if (this.animate_interval) {
        clearInterval(this.animate_interval);
      }
      this.animate_interval = null;
      return this.toggler.attr('value', 'Start');
    };

    Mandala.prototype.draw = function() {
      var angle, i, x, y, _i, _ref, _results;
      this.canvas.clearRect(0, 0, this.attrs.get('height'), this.attrs.get('width'));
      this.canvas.beginPath();
      _results = [];
      for (i = _i = 0, _ref = this.attrs.get('num_circles') - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
        angle = ((2.0 * Math.PI / this.attrs.get('num_circles')) * i) + this.attrs.get('offset');
        x = this.attrs.get('avg') / 3 * Math.sin(angle);
        y = this.attrs.get('avg') / 3 * Math.cos(angle);
        this.canvas.beginPath();
        this.canvas.arc(this.attrs.get('mid').x + x, this.attrs.get('mid').y + y, this.attrs.get('avg') / 15, 0, 2.0 * Math.PI);
        _results.push(this.canvas.stroke());
      }
      return _results;
    };

    return Mandala;

  })();

  $(window).ready(function() {
    var m;
    return m = new Mandala('mandala-canvas');
  });

}).call(this);
